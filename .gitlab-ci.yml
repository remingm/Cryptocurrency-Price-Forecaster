include: 
  - 'deployment/templates/.ci-templates.yml'

stages:
    - build-image-push-ecr
    - deploy

backend-build-image-push-ecr:
  stage: build-image-push-ecr
  extends:
    - .backend-variables
    - .int-environment
    - .build-image-push-ecr 
  only:
    - main

ml-build-image-push-ecr:
  extends:
    - .ml-backend-variables
    - .int-environment    
    - .build-image-push-ecr
  stage: build-image-push-ecr
  only:
    - main
    - stonkpix.mlInfrastructure

backend-deploy:
  stage: deploy
  extends:
    - .backend-variables
    - .int-environment    
    - .deploy 
  only:
    - main

ml-backend-deploy:
  stage: deploy
  extends:
    - .ml-backend-variables
    - .int-environment    
    - .deploy 
  only:
    - main
    - stonkpix.mlInfrastructure